---
description: Global workspace rules — Sierac-tm project core process, principles, and pointers to domain rules.
globs:
  - "*"
alwaysApply: true
---
# Sierac-tm 工作指导总纲

> **版本**: v3.0.0 (2026-02-28)
> **项目**: Sierac-tm — 基于 Cursor 官方数据的项目激励平台
> **许可证**: MIT

---

## 〇、项目定位

**Sierac-tm** 是一个**基于 Cursor 官方数据的项目激励平台**。

> **核心理念：立项定预算，数据看贡献，激励促转型。**

### 三件事

1. **项目立项**：登记项目、关联仓库、设定预算与激励池
2. **贡献可视化**：基于 Cursor 官方 API 自动采集 AI 代码贡献，按项目和成员展示
3. **项目激励**：根据 AI 代码贡献自动计算激励分配，推动团队 AI 转型

### 设计原则

| 原则 | 说明 |
|------|------|
| **纯服务端** | 不在成员机器上安装任何东西，零部署成本 |
| **官方数据驱动** | 数据来自 Cursor 官方 API，无法绕开、无法作假 |
| **激励而非监控** | 展示贡献、激励参与，不做拦截、不做负面排名 |
| **简单规则** | 激励规则透明，每个人都能算出自己的份额 |
| **轻量立项** | 立项 = 登记项目信息，不自动创建仓库 |

### 不做的事

| 不做 | 原因 |
|------|------|
| Hook（客户端拦截/上报） | 官方 API 数据更全、更准、无法绕开 |
| 白名单准入拦截 | 管理手段解决，不需要技术拦截 |
| GitLab 仓库自动创建 | 过度工程，手动关联即可 |
| 多角色贡献度量 | 无自动化数据源，靠管理手段 |
| 复杂多维度权重 | 简单规则更公平、更透明 |

---

## 一、文档结构

| 文档 | 内容 | 状态 |
|------|------|------|
| **主文档** (本文档) | 核心索引、项目定位、工作流程 | ✅ |
| **核心原则** | `.cursor/rules/sierac_principles.mdc` | ✅ |
| **开发规范** | `.cursor/rules/sierac_development.mdc` | ✅ |
| **架构规范** | `.cursor/rules/sierac_architecture.mdc` | ✅ |
| **测试规范** | `.cursor/rules/sierac_testing.mdc` | ✅ |
| **Spec 标准** | `.cursor/rules/sierac_spec_standards.mdc` | ✅ |
| **数据库规范** | `.cursor/rules/sierac_database.mdc` | ✅ |
| **总体架构** | `docs/ARCHITECTURE.md`（唯一架构真源） | ✅ |

---

## 二、AI 必读文档

| 阅读场景 | 文档 | 内容 |
|----------|------|------|
| 每次 | 本文档 | 项目定位与核心原则 |
| 每次 | `docs/ARCHITECTURE.md` | 架构设计（唯一真源） |
| 开发 | `.cursor/rules/sierac_principles.mdc` | 核心原则（代码质量、禁止行为） |
| 开发 | `.cursor/rules/sierac_development.mdc` | 开发规范（流程、Git、依赖管理） |
| 架构 | `.cursor/rules/sierac_architecture.mdc` | 架构规范（包结构、集成边界） |
| 数据库 | `.cursor/rules/sierac_database.mdc` | 数据库编码规范 |
| 测试 | `.cursor/rules/sierac_testing.mdc` | 测试规范 |
| 写/改 spec | `.cursor/rules/sierac_spec_standards.mdc` | Spec 文档标准 |

### AI 工作流程

```
1. 接收任务
 ↓
2. 阅读本文档（项目定位：项目激励平台，纯服务端，无 Hook）
 ↓
3. 根据任务类型阅读相关子文档
 ↓
4. 阅读 docs/ARCHITECTURE.md（理解架构决策）
 ↓
5. 检查影响范围（grep 搜索）
 ↓
6. 新功能/重大重构：确认已有 spec（三层齐全）再编码；无 spec 则先补齐
 ↓
7. 阅读相关代码
 ↓
8. 开始编码
```

---

## 三、关键规则速查

### 业务规则

| 规则 | 说明 |
|------|------|
| **项目为一等实体** | 所有贡献、预算、激励围绕「项目」组织 |
| **官方数据唯一来源** | 贡献数据来自 Cursor AI Code Tracking API，不自建采集 |
| **激励而非监控** | UI 措辞传达「认可」而非「监视」；禁止负面排名 |
| **简单激励规则** | 激励池 × 贡献占比 × 交付系数，3-5 个核心指标 |
| **禁止假数据** | 数据获取失败返回空结果，不返回硬编码备用数据 |

### 技术规则

| 规则 | 说明 | 详细文档 |
|------|------|---------|
| **禁止 TODO 预留** | 未完成功能记录在 tasks.md | `sierac_development.mdc` |
| **依赖管理** | Python: Poetry; Node: npm | `sierac_development.mdc` |
| **Python >= 3.10** | 类型注解用现代语法 | `sierac_development.mdc` |
| **先规划后执行** | 重构/修改前必须制定完整方案 | `sierac_development.mdc` |
| **Spec 文档规范** | 新功能必须使用三层文档结构 | `sierac_spec_standards.mdc` |
| **代码英文/文档中文** | 代码注释 English，文档中文 | `sierac_principles.mdc` |
| **Cursor API 单点出口** | 所有 Cursor API 调用必须经 `cursor_api.py` | `sierac_architecture.mdc` |

---

## 四、数据来源

所有数据来自 Cursor 官方 API，纯服务端采集：

| API | 数据 | 用途 |
|-----|------|------|
| **Admin API** | 成员列表、每日用量、支出 | 基础数据、预算追踪 |
| **AI Code Tracking API** | 每个 commit 的 AI 代码归因 | **贡献度量核心** |
| **Analytics API** | 团队 DAU、模型分布 | 采用率趋势 |

### 贡献归属

AI Code Tracking API 返回 `repoName`，系统通过匹配 `projects.git_repos` 自动归属到项目。无需 Hook、无需白名单。

---

## 五、Spec 循环（触发词：spec循环 / 继续 / 挨个完成 / 全部完成 / 持续推进 / 自主推进）

**Goal**：将 SPEC_TASKS_SCAN 功能清单与各 spec 的 tasks.md 中 `[ ]` 通过实现+验收变为 `[x]`，直至无未勾项或用户叫停。

**Authority**：`.kiro/specs/SPEC_TASKS_SCAN.md` 功能清单；各 spec 的 `tasks.md`。

### Rules

- **验收标准**：仅当实现+验收通过可打勾；写入 spec 的 task = 必须完成。
- **批次控制**：单次循环最多完成 3 个 task；完成后更新文档、检查点，再评估是否继续。
- **Context 管理**：每完成一个完整 spec 后，或累计执行超过 5 轮后，执行 `/compact`。
- **失败处理**：验收失败分析原因 → 设计问题回退 design.md；实现问题回滚重做；同一 task 连续失败 3 次标记 blocked。
- **每轮提交**：每一轮 spec 循环结束后执行 git commit。
- **资源释放**：测试后确保子进程已退出；优先使用 `pytest --timeout=30`。

### Loop

1. **Check** — 取未打勾项。
2. **Plan** — 选择下一批次（1～3 个 task）。
3. **Do** — Act → Observe → Reflect → Verify。通过 → `[x]`。
4. **Doc** — 更新 SPEC_TASKS_SCAN 检查点。
5. **Commit** — git commit。
6. **Evaluate** — 仍有 `[ ]` → 回 1。

### Exit

1. 用户叫停
2. 所有 tasks.md 均已全部打勾
3. 下一批次需用户决策或外部输入
4. 健康检查触发（同一 task 连续失败 3 次）

---

## 六、执行承诺

- **纯服务端，无 Hook**：不在成员机器上安装任何东西
- **官方数据驱动**：所有贡献数据来自 Cursor 官方 API
- 代码英文，文档中文
- 先规划后执行，一次到位
- 依赖管理：Python 用 Poetry，Node 用 npm
- 测试覆盖关键路径
- Spec 文档规范，新功能必须使用三层文档结构
- Cursor API 单点出口
- **禁止假数据**

---

**维护者**: yeemio
**下次审核**: 2026-03-15
