# Requirements: 贡献可视化与团队激励

> **目标**：基于已立项项目的多源数据（Git + Cursor API + Hook），实现贡献度计算、个人贡献画像、排行榜与激励闭环。  
> **优先级**：P1（依赖 cursor-admin-projects 完成后启动）  
> **预估工作量**：10–15 天

---

## 文档联动

- requirements: `.kiro/specs/cursor-admin-incentives/requirements.md`
- design: `.kiro/specs/cursor-admin-incentives/design.md`
- tasks: `.kiro/specs/cursor-admin-incentives/tasks.md`

---

## 1. 背景与动机

- 在项目立项与治理（cursor-admin-projects）基础上，已有按项目归集的 Git 贡献、会话参与、用量数据。
- 需要将这些数据融合为**贡献度评分**，实现「贡献可见 → 排行激励 → 主动参与 → 贡献更多」的闭环。
- 数据来源为多源融合：**Git 贡献**（第一数据源）+ **daily_usage**（效率参考）+ **agent_sessions**（参与信号）。
- 所有贡献数据按已立项项目聚合，未立项项目不参与贡献计算。

---

## 2. 用户故事（预留）

### 2.1 作为管理员

**故事**：查看按周期（周/月）的成员贡献度排行与得分，并支持配置评分规则（权重、维度）。

**验收标准**（待细化）：
- [ ] 支持多维度得分：如 Agent 使用量、会话时长、工作目录深度、代码行贡献等。
- [ ] 支持可配置权重与周期；排行可按时段快照留存。
- [ ] 数据来源于现有 daily_usage、agent_sessions、spend，不新增 Hook。

### 2.2 作为成员

**故事**：查看自己的得分与在团队中的相对排名（若开放）。

**验收标准**（待细化）：
- [ ] 提供「我的得分」「我的排名」视图；权限由管理员控制。

---

## 3. 功能需求（预留）

- **FR-1**：贡献度指标定义（基于现有表的聚合：如 agent_requests、duration_seconds、total_lines_added 等）。
- **FR-2**：评分规则配置（权重、周期、维度）；规则存储与版本管理。
- **FR-3**：定期计算得分并写入 contribution_scores 或等价表；可选 leaderboard_snapshots。
- **FR-4**：管理端与成员端 API/页面：排行、得分、历史快照。

具体字段与接口在启动本 spec 时于 design.md 中补全。

---

## 4. 业务设计：与 Hook 挂钩（推荐）

为提升成员安装 Hook 的意愿，建议在激励设计上**与 Hook 数据挂钩**，形成「装 Hook → 被统计 → 参与激励」的正向循环：

| 策略 | 做法 | 优点 |
|------|------|------|
| **仅认可 Hook 数据** | 贡献度/排行只统计来自 `agent_sessions` 的会话（工作目录、时长）；未装 Hook 的成员在「工作目录/会话」维度得分为 0 或不参与该维度。 | 逻辑清晰：想要细粒度被看见就要装 Hook。 |
| **双轨展示** | 用量维度（Agent/Chat 请求等）用 Cursor API 数据，人人可见；工作目录/会话维度仅对有 Hook 数据的人展示，并在 UI 标注「已接入 / 未接入」。 | 公平：用量人人有；深度数据可选、装 Hook 者多得。 |
| **参与门槛** | 例如：只有「本周期内有至少一条 Hook 上报」的成员才进入排行榜或才有「我的得分」；或未接入者显示为「未接入，不参与排行」。 | 避免「不装也能蹭排行」，强化安装动机。 |
| **个人收益** | 成员端提供「我的工作目录统计」「我的会话时长」等仅基于 Hook 的视图；装 Hook 才能看到自己的细粒度画像。 | 利己动机：为自己看数据而装。 |

**建议组合**：采用「仅认可 Hook 数据」+「参与门槛」+「个人收益」——排行与贡献度只计 Hook 可验证的会话/目录数据，未接入者不进入排行或仅显示用量；同时给成员「我的细粒度统计」视图，形成业务上的挂钩。

---

## 4.1 先进经验与设计优化（参考业界实践）

在业务设计上参考以下经验，对「与 Hook 挂钩」与激励整体做优化：

### 透明与 opt-in（参考：Go Transparent Telemetry、Clean Insights）

- **先说明收益再要求安装**：在安装说明、首次引导、文档中明确写出「装 Hook 后你会得到什么」（如：我的工作目录统计、参与排行、个人得分），而不是只写「请安装以配合管理」。  
- **公布收集项与用途**：在 README 或管理端固定位置提供《数据收集与用途说明》（如：Hook 上报的字段、用于工作目录/会话/贡献度的哪些能力、谁可见、保留周期），避免「黑盒感」，提高信任与自愿接入率。  
- **请求时机**：在成员已产生一次 Agent 使用后，再提示「接入后可查看本周期你的工作目录与时长」比冷启动时弹安装更易接受。

### Developer-First 采用节奏（参考：Harness IDP Adoption Playbook）

- **先解决成员端诉求，再推管理端管控**：优先上线「我的工作目录」「我的会话时长」「我的得分」等**个人收益**功能，让装 Hook 的成员立刻看到回报；再铺开排行榜与管理员视图。  
- **小范围试点**：先对 1～2 个愿意配合的团队推广 Hook + 激励，验证「装 Hook → 看到数据 → 参与排行」闭环与反馈，再扩大到全公司。  
- **以「每日/每周有用」为目标**：激励与数据展示应能融入成员日常（如周报可引用、绩效可参考），而不是季度才看一次，否则粘性不足。

### 防刷与质量优先（参考：gamification 与 leaderboard 研究）

- **多维度、可配置权重**：贡献度不依赖单一指标（如仅「会话数」或「时长」），而是多维度（用量、会话时长、工作目录广度/深度、代码行等）组合，权重可配置，降低「刷单维」动机。  
- **避免纯数量激励**：若仅按会话数/时长排名，易诱发刷时长等行为；建议结合「工作目录数」「与 repo 的关联」等难以作假的维度，或对单日/单周会话数设合理上限参与计分。  
- **规则透明、可审计**：评分规则与周期在管理端可查看、可导出；排行快照留存，便于事后解释与审计，减少「黑箱排名」带来的不信任。

### 与 Hook 挂钩的落地顺序建议

1. **第一阶段**：成员端「我的工作目录 / 我的会话时长」（仅 Hook 数据）+ 文档与安装流程中明确「装 Hook 才能看到这些」。  
2. **第二阶段**：贡献度计算与「我的得分」；仅对本周期有 Hook 上报的成员显示得分，未接入者显示「未接入，不参与」。  
3. **第三阶段**：排行榜与管理员视图；可选「仅展示已接入 Hook 的成员」或「未接入者标注、会话维度为 0」。

---

## 5. 约束与假设

- **依赖 cursor-admin-projects**：贡献度计算基于 `git_contributions`（按项目按人按日）和 `agent_sessions`（按项目归属），需 projects spec 完成后启动。
- Git 贡献是贡献度的第一数据源（最客观、最难作假）；daily_usage 作为效率参考维度。
- 与 cursor-admin-core 共享 DB；扩展表需在 design 中定义并提供迁移。
- 贡献度计算需区分数据来源：Git 贡献人人有（只要 commit）；agent_sessions 仅装 Hook 者有；daily_usage 人人有。

---

## 6. 依赖

- **内部**：cursor-admin-projects（projects 表、git_contributions 表、agent_sessions.project_id）。
- **内部**：cursor-admin-core（sync 与表结构、Collector 框架）。

---

## 7. 参考文档

- `docs/ARCHITECTURE.md` §5（扩展：团队激励管理）
- `.kiro/specs/cursor-admin-core/`

---

**维护者**: 团队  
**最后更新**: 2026-02-25  
**状态**: 待启动（依赖 cursor-admin-projects 完成）
